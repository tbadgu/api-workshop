# API Workshop Solution

Soution has been implemented with a minor change to incorporate Open API Specifications rather than Swagger V2 Specifications.

We have incorporated below features in the solution from Open API perspective:
* Open API Specification Based Swagger UI Configuration for the Rest API's
* Build task to generate the json specification file to be included in the artifact
* Request/Response Validation based on the json specification file

Above was achieved using a set of Libraries:

### Springdoc OpenApi
[springdoc-openapi](https://springdoc.org/) library provides the capabilty to generate specifications conforming to Open API standards based on [Swagger V3 annotations](https://github.com/swagger-api/swagger-core/wiki/Swagger-2.X---Annotations) and JSR-303 Spring validation annotations.

Library also has support to generate Swagger UI bases on the specification file generated which provides great tool for visualizing your Rest API's.

Open API Specification is exposed on path v3/api-docs of the base url for the Rest API. For this example it will be exposed at [http://localhost:8080/v3/api-docs](http://localhost:8080/v3/api-docs)

Swagger UI based of the specification is exposed on path swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config of the base url for the Rest API. For this example it will be exposed at [http://localhost:8080/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config](http://localhost:8080/swagger-ui/index.html?configUrl=/v3/api-docs/swagger-config)

Gradle configuration to add library dependency:
```groovy
dependencies {
	implementation 'org.springdoc:springdoc-openapi-ui:1.4.3'
}
```

### Springdoc OpenAPI Gradle Plugin
[springdoc-openapi-gradle-plugin](https://github.com/springdoc/springdoc-openapi-gradle-plugin) plugin enables us to generate the json specification file at build time by querying the rest endpoint which exposes the specification.

Plugin provide a gradle task named `generateOpenApiDocs` which will generate the json specification file at the configured directory by querying the configured url endpoint.

Gradle configuration to add plugin dependency:
```groovy
plugins {
	id 'com.github.johnrengelman.processes' version '0.5.0'
	id 'org.springdoc.openapi-gradle-plugin' version '1.3.0'
}

openApi {
	apiDocsUrl.set("http://localhost:8080/v3/api-docs")
	outputDir.set(file("$buildDir/resources/main"))
}
```

### Atlassian Swagger Request Validator
[swagger-request-validator](https://bitbucket.org/atlassian/swagger-request-validator/src/master/) enables us to perform Request/Response validation based on the Open API Specification generated by the library.

It does this by adding an Interceptor to the context which will do the validation. You can configure the validator to perform validation only for either Request or Response along with required customizations.

Gradle configuration to add library dependency:
```groovy
dependencies {
	implementation 'com.atlassian.oai:swagger-request-validator-springmvc:2.10.1'
}
```

Simplest configuration of the validator:
```java
@Configuration
@EnableWebMvc
public class OpenApiValidatorConfig implements WebMvcConfigurer {
    private final OpenApiValidationInterceptor validationInterceptor;

    public OpenApiValidatorConfig() throws IOException {
        final EncodedResource specResource = new EncodedResource(
                new ClassPathResource("openapi.json"),
                "UTF-8");
        this.validationInterceptor = new OpenApiValidationInterceptor(specResource);
    }

    @Bean
    public Filter validationFilter() {
        return new OpenApiValidationFilter(
                true,   // Validate Requests
                true    // Validate Responses
        );
    }

    @Override
    public void addInterceptors(final InterceptorRegistry registry) {
        registry.addInterceptor(validationInterceptor);
    }
}
```

##### Running the application
Run the application by executing gradle wrapper comamnd:
```shell script
.\gradlew clean generateOpenApiDocs bootRun
```